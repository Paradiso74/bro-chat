<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BroChat</title>
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#000;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* LOGIN */
#login{
  color:white;
  text-align:center;
}

#login input{
  padding:10px;
  border-radius:20px;
  border:none;
  margin-top:10px;
  width:200px;
}

#login button{
  margin-top:10px;
  padding:8px 20px;
  border:none;
  border-radius:20px;
  background:#00ff99;
  cursor:pointer;
}

/* CHAT */
#chatContainer{
  display:none;
  width:100%;
  height:100vh;
  flex-direction:column;
}

header{
  background:#111;
  color:white;
  text-align:center;
  padding:15px;
  font-size:20px;
  font-weight:bold;
}

#chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
  display:flex;
  flex-direction:column;
}

.message{
  background:#1f1f1f;
  color:white;
  padding:8px;
  margin:5px 0;
  border-radius:10px;
  max-width:70%;
  position:relative;
}

.deleteBtn{
  position:absolute;
  top:5px;
  right:8px;
  cursor:pointer;
  font-size:12px;
  color:#ff4444;
}

.name{
  font-size:12px;
  color:#00ff99;
  font-weight:bold;
}

.time{
  font-size:10px;
  color:#aaa;
  text-align:right;
  margin-top:4px;
}

.message img{
  max-width:100%;
  border-radius:8px;
  margin-top:5px;
}

.controls{
  display:flex;
  padding:10px;
  background:#111;
}

.controls input{
  flex:1;
  padding:8px;
  border-radius:20px;
  border:none;
  outline:none;
}

button{
  margin-left:5px;
  border:none;
  border-radius:50%;
  width:40px;
  height:40px;
  cursor:pointer;
  font-size:18px;
}

#sendBtn{
  background:#00ff99;
}

#audioBtn{
  background:#ff4444;
  color:white;
}

#imgInput{
  display:none;
}
</style>
</head>
<body>

<div id="login">
  <h1>BroChat</h1>
  <p>IngresÃ¡ tu nombre</p>
  <input type="text" id="nameInput" placeholder="Tu nombre">
  <br>
  <button onclick="enterChat()">Entrar</button>
</div>

<div id="chatContainer">
  <header>BroChat</header>
  <div id="chat"></div>
  <div class="controls">
    <input type="text" id="messageInput" placeholder="Mensaje">
    <input type="file" id="imgInput" accept="image/*">
    <button onclick="document.getElementById('imgInput').click()">ðŸ“·</button>
    <button id="audioBtn">ðŸŽ¤</button>
    <button id="sendBtn">âž¤</button>
  </div>
</div>

<script>
let userName="";
let mediaRecorder;
let audioChunks=[];
const chat=document.getElementById("chat");

function enterChat(){
  const name=document.getElementById("nameInput").value.trim();
  if(name===""){
    alert("PonÃ© un nombre primero");
    return;
  }
  userName=name;
  document.getElementById("login").style.display="none";
  document.getElementById("chatContainer").style.display="flex";
}

function getTime(){
  const now=new Date();
  return now.getHours().toString().padStart(2,"0")+":"+
         now.getMinutes().toString().padStart(2,"0");
}

function addMessage(content,isAudio=false){
  const msgDiv=document.createElement("div");
  msgDiv.className="message";

  const deleteBtn=document.createElement("span");
  deleteBtn.className="deleteBtn";
  deleteBtn.innerText="âŒ";
  deleteBtn.onclick=()=>msgDiv.remove();
  msgDiv.appendChild(deleteBtn);

  const nameDiv=document.createElement("div");
  nameDiv.className="name";
  nameDiv.innerText=userName;
  msgDiv.appendChild(nameDiv);

  if(isAudio){
    const audio=document.createElement("audio");
    audio.controls=true;
    audio.src=content;
    msgDiv.appendChild(audio);
  }else{
    const text=document.createElement("div");
    text.innerHTML=content;
    msgDiv.appendChild(text);
  }

  const time=document.createElement("div");
  time.className="time";
  time.innerText=getTime();
  msgDiv.appendChild(time);

  chat.appendChild(msgDiv);
  chat.scrollTop=chat.scrollHeight;
}

document.getElementById("sendBtn").onclick=function(){
  const message=document.getElementById("messageInput");
  if(message.value.trim()!==""){
    addMessage(message.value);
    message.value="";
  }
};

document.getElementById("imgInput").onchange=function(e){
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=function(){
    addMessage(`<img src="${reader.result}">`);
  };
  if(file) reader.readAsDataURL(file);
};

const audioBtn=document.getElementById("audioBtn");

audioBtn.addEventListener("mousedown",async ()=>{
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder=new MediaRecorder(stream);
  mediaRecorder.start();
  audioChunks=[];
  mediaRecorder.ondataavailable=e=>{
    audioChunks.push(e.data);
  };
});

audioBtn.addEventListener("mouseup",()=>{
  if(mediaRecorder){
    mediaRecorder.stop();
    mediaRecorder.onstop=()=>{
      const blob=new Blob(audioChunks,{type:'audio/webm'});
      const audioURL=URL.createObjectURL(blob);
      addMessage(audioURL,true);
    };
  }
});
</script>

</body>
</html>